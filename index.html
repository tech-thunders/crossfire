<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="header.css" />
  <title>ThunderTrack</title>
</head>

<body>
  <header>
    <nav>
      <div class="navbar">
        <div>
          <a href="index.html"><img src="images/Crossfire Logo-transparent.png" alt="Crossfire Logo" class="logo" /></a>
        </div>
        <div class="navbar-links">
          <ul>
            <li>
              <a href="index.html"><i class="bi bi-house-fill"></i>
                Dashboard</a>
            </li>
            <li>
              <a href="view-ncr.html"><i class="bi bi-file-earmark-bar-graph-fill" style="font-weight: 900"></i>
                NCR Log</a>
            </li>
            <li>
              <a href="create-ncr.html"><i class="bi bi-file-earmark-plus-fill"></i> Create NCR</a>
            </li>
          </ul>
        </div>
        <div class="navbar-icons">
        <div onclick="closePopUp()" title="Notifications" class="navbar-notification">
          <i id="notification-icon" class="bi bi-bell-fill"></i>
        </div>
        <div onclick="toggleMenu()" title="Menu" class="navbar-menu">
          <i id="menu-icon"></i>
        </div>
      </div>
      <div id="notificationPopup" title="Notifications" class="notification-popup hidden">
        <p>No new notifications</p>
      </div>
      </div>
    </nav>
  </header>
  <main>
    <div id="wrapper">
      <section>
        <div class="dashboard-summary">
          <h1>NCR Summary</h1>
          <div class="row">
            <div class="col m4 card">
              <div class="icon-circle card-blue">
                <i class="bi bi-archive"></i>
              </div>
              <div>
                <p>All NCRs</p>
                <h3 id="total-ncr-summary">20</h3>
              </div>
            </div>
            <div class="col m4 card">
              <div class="icon-circle card-green">
                <i class="bi bi-check2-circle"></i>
              </div>
              <div>
                <p>Active NCRs</p>
                <h3 id="active-ncr">12</h3>
              </div>
            </div>
            <div class="col m4 card">
              <div class="icon-circle card-red">
                <i class="bi bi-x-circle"></i>
              </div>
              <div>
                <p>Closed NCRs</p>
                <h3>8</h3>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <div id="wrapper">

      <h1>Recent NCRs</h1>
      <div class="container">
        <div class="filter-buttons">
          <button class="filter-btn active" data-status="all">All NCR</button>
          <button class="filter-btn" data-status="Active">Active</button>
          <button class="filter-btn" data-status="Closed">Closed</button>
        </div>

        <input type="text" id="search" placeholder="Filter results by NCR No, Supplier Name, Date or Status..." />

        <div class="table-container">
          <table id="ncrTable">
            <thead>
              <tr>
                <th onclick="sortTable(0)">NCR No. ▲▼</th>
                <th onclick="sortTable(1)">Current Status ▲▼</th>
                <th onclick="sortTable(2)">Date Created ▲▼</th>
                <th onclick="sortTable(3)">Supplier Name ▲▼</th>
                <th colspan="2">Action</th>
              </tr>
            </thead>
            <tbody id="ncrTableBody"></tbody>
          </table>
        </div>

        <div class="pagination" id="pagination"></div>
      </div>
    </div>
  </main>

  <footer>&copy;Tech Thunders 2025</footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="scripts/data-manager.js"></script>
  <script src="scripts/script.js"></script>
  <script>
    // NCR Data Management
    let ncrData = [];
    let filteredData = [];
    let currentPage = 1;
    const rowsPerPage = 5;
    let sortColumn = -1;
    let sortAsc = true;

    // Load NCR data
    fetch("data/ncrData2.json")
      .then((response) => response.json())
      .then((data) => {
        ncrData = data;
        filteredData = [...ncrData];
        renderTable();
      })
      .catch((error) => console.error("Error loading NCR data:", error));

    function renderTable() {
      const tableBody = document.getElementById("ncrTableBody");
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredData.slice(start, end);

      tableBody.innerHTML = "";

      pageData.forEach((item) => {
        const date = new Date(item.dateCreated);
        const formattedDate = date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });


        const row = `
            <tr>
              <td>${item.ncrNumber}</td>
              <td>${item.currentStage.charAt(0).toUpperCase() +
          item.currentStage.slice(1)
          }</td>
              <td>${formattedDate}</td>
              <td>${item.supplierName}</td>
              <td><a href="detailedViewNCR.html?ncr=${item.ncrNumber
          }" class="view-ncr">View</a></td>
              <td><a href="edit-ncr.html" onClick="selectedLog('${item.ncrNumber}')" class="view-ncr">Edit</a></td>
            </tr>
          `;
        tableBody.innerHTML += row;
      });

      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredData.length / rowsPerPage);
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      for (let i = 1; i <= totalPages; i++) {
        pagination.innerHTML += `<button class="${i === currentPage ? "active" : ""
          }" onclick="goToPage(${i})">${i}</button>`;
      }
    }

    function goToPage(page) {
      currentPage = page;
      renderTable();
    }

    // Search
    document
      .getElementById("search")
      .addEventListener("input", function () {
        const query = this.value.toLowerCase();
        filteredData = ncrData.filter(
          (item) =>
            item.ncrNumber.toLowerCase().includes(query) ||
            item.currentStage.toLowerCase().includes(query) ||
            item.supplierName.toLowerCase().includes(query) ||
            new Date(item.dateCreated)
              .toLocaleDateString("en-US")
              .toLowerCase()
              .includes(query)
        );
        currentPage = 1;
        renderTable();
      });

    // Filter buttons
    document.querySelectorAll(".filter-btn").forEach((btn) =>
      btn.addEventListener("click", () => {
        document
          .querySelectorAll(".filter-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        const status = btn.dataset.status;
        filteredData =
          status === "all"
            ? [...ncrData]
            : ncrData.filter((item) => item.status === status);
        currentPage = 1;
        renderTable();
      })
    );

    // Sorting
    function sortTable(colIndex) {
      const keys = [
        "ncrNumber",
        "currentStage",
        "dateCreated",
        "supplierName",
      ];
      if (sortColumn === colIndex) sortAsc = !sortAsc;
      else sortAsc = true;
      sortColumn = colIndex;

      filteredData.sort((a, b) => {
        const valA = a[keys[colIndex]].toLowerCase();
        const valB = b[keys[colIndex]].toLowerCase();
        return (
          (valA > valB ? 1 : valA < valB ? -1 : 0) * (sortAsc ? 1 : -1)
        );
      });
      renderTable();
    }
  </script>
</body>

</html>