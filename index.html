<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="header.css" />
    <title>ThunderTrack</title>
    <style>
      /* Page Content */
      h1 {
        text-align: center;
        color: #333;
        background-color: #e0e0e0;
        padding: 20px;
        width: 100%;
      }

      .container {
        width: 85%;
        background-color: white;
        margin: 30px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .filter-buttons {
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .filter-buttons button {
        background-color: #e0e0e0;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
      }

      .filter-buttons button.active {
        background-color: #5897c9;
        color: white;
      }

      input {
        width: 60%;
        padding: 10px;
        margin: 20px auto;
        display: block;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      .download-btn {
        display: block;
        margin: 10px auto 25px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
        font-weight: 500;
      }

      .download-btn:hover {
        background-color: #218838;
      }

      /* Table Responsiveness */
      .table-container {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        border-radius: 10px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background-color: #fff;
        border-radius: 8px;
        min-width: 600px;
      }

      th,
      td {
        padding: 15px;
        text-align: center;
        color: #333;
      }

      th {
        background-color: #e0e0e0;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        cursor: pointer;
      }

      tr:nth-child(odd) {
        background-color: #f7f7f7;
      }

      tr:hover {
        background-color: #e0f0ff;
        transition: 0.3s;
      }

      .view-ncr {
        padding: 6px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        color: white;
        background-color: #5897c9;
      }

      .view-ncr:hover {
        background-color: #417aa7;
      }

      .pagination {
        text-align: center;
        margin-top: 20px;
      }

      .pagination button {
        background-color: #e0e0e0;
        border: none;
        padding: 8px 12px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
      }

      .pagination button.active {
        background-color: #5897c9;
        color: white;
      }

      /* ðŸ“± Mobile Responsive Styles */
      @media screen and (max-width: 768px) {
        .container {
          width: 95%;
          padding: 15px;
        }

        h1 {
          font-size: 22px;
          padding: 15px;
        }

        input {
          width: 90%;
          font-size: 14px;
        }

        .filter-buttons button {
          padding: 8px 12px;
          font-size: 14px;
        }

        table {
          font-size: 14px;
          min-width: 500px;
        }

        th,
        td {
          padding: 10px;
        }

        .download-btn {
          width: 90%;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div class="navbar">
          <div>
            <a href="index.html"><img
                src="images/Crossfire Logo-transparent.png"
                alt
                style="width: 25%" /></a>
          </div>
          <div class="navbar-links">
            <ul>
              <li>
                <a href="index.html"><i class="bi bi-menu-button-wide"></i>
                  Dashboard</a>
              </li>
              <li>
                <a href="view-ncr.html"><i class="bi bi-journal"></i> View NCR
                  Log</a>
              </li>
              <!--<li><a href="view-ncr.html">View Reports</a></li>-->
            </ul>
          </div>
          <div onclick="toggleMenu()" title="Menu" class="navbar-menu">
            &#9776;
          </div>
        </div>
      </nav>
    </header>
    <main>
      <div id="wrapper">
        <section>
          <div class="dashboard-summary">
            <h1>NCR Summary</h1>
            <div class="row">
              <div class="col m4 card">
                <div class="icon-circle card-blue">
                  <i class="bi bi-archive"></i>
                </div>
                <div>
                  <p>All NCRs</p>
                  <h3>34</h3>
                </div>
              </div>
              <div class="col m4 card">
                <div class="icon-circle card-green">
                  <i class="bi bi-check2-circle"></i>
                </div>
                <div>
                  <p>Active NCRs</p>
                  <h3>34</h3>
                </div>
              </div>
              <div class="col m4 card">
                <div class="icon-circle card-red">
                  <i class="bi bi-x-circle"></i>
                </div>
                <div>
                  <p>Closed NCRs</p>
                  <h3>34</h3>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- <div class="dashboard-btns">
          <a href="create-ncr.html"><button type="button" class="ncr-buttons">
              <i class="bi bi-file-plus"></i> Create NCR
            </button></a>
          <a href="view-ncr.html"><button type="button" class="ncr-buttons">
              <i class="bi bi-journal"></i> NCR Log
            </button></a>
          <a href="create-ncr.html"><button type="button" class="ncr-buttons">
              <i class="bi bi-pencil-square"></i> Edit NCR
            </button></a>
        </div> -->
      </div>

      <!-- âœ… Page Content -->
      <h1>Recent NCRs</h1>
      <div class="container">
        <div class="filter-buttons">
          <button class="filter-btn active" data-status="all">All NCR</button>
          <button class="filter-btn" data-status="Active">Active</button>
          <button class="filter-btn" data-status="Closed">Closed</button>
        </div>

        <input
          type="text"
          id="search"
          placeholder="Filter results by NCR No, Supplier Name, Date or Status..." />

        <div class="table-container">
          <table id="ncrTable">
            <thead>
              <tr>
                <th onclick="sortTable(0)">NCR No. â–²â–¼</th>
                <th onclick="sortTable(1)">Current Status â–²â–¼</th>
                <th onclick="sortTable(2)">Date Created â–²â–¼</th>
                <th onclick="sortTable(3)">Supplier Name â–²â–¼</th>
                <th colspan="2">Action</th>
              </tr>
            </thead>
            <tbody id="ncrTableBody"></tbody>
          </table>
        </div>

        <div class="pagination" id="pagination"></div>
      </div>

      <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
      <script>
        // Navbar toggle
        function toggleMenu() {
          const links = document.querySelector(".navbar-links");
          links.style.display =
            links.style.display === "grid" ? "none" : "grid";
        }

        let ncrData = [];
        let filteredData = [];
        let currentPage = 1;
        const rowsPerPage = 5;
        let sortColumn = -1;
        let sortAsc = true;

        // Load NCR data
        fetch("data/ncrData2.json")
          .then((response) => response.json())
          .then((data) => {
            ncrData = data;
            filteredData = [...ncrData];
            renderTable();
          })
          .catch((error) => console.error("Error loading NCR data:", error));

        function renderTable() {
          const tableBody = document.getElementById("ncrTableBody");
          const start = (currentPage - 1) * rowsPerPage;
          const end = start + rowsPerPage;
          const pageData = filteredData.slice(start, end);

          tableBody.innerHTML = "";

          pageData.forEach((item) => {
            const date = new Date(item.dateCreated);
            const formattedDate = date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            });

            const row = `
            <tr>
              <td>${item.ncrNumber}</td>
              <td>${
                item.currentStage.charAt(0).toUpperCase() +
                item.currentStage.slice(1)
              }</td>
              <td>${formattedDate}</td>
              <td>${item.supplierName}</td>
              <td><a href="detailedViewNCR.html?ncr=${
                item.ncrNumber
              }" class="view-ncr">View</a></td>
              <td><a href="create-ncr.html" class="view-ncr">Edit</a></td>
            </tr>
          `;
            tableBody.innerHTML += row;
          });

          renderPagination();
        }

        function renderPagination() {
          const totalPages = Math.ceil(filteredData.length / rowsPerPage);
          const pagination = document.getElementById("pagination");
          pagination.innerHTML = "";

          for (let i = 1; i <= totalPages; i++) {
            pagination.innerHTML += `<button class="${
              i === currentPage ? "active" : ""
            }" onclick="goToPage(${i})">${i}</button>`;
          }
        }

        function goToPage(page) {
          currentPage = page;
          renderTable();
        }

        // Search
        document
          .getElementById("search")
          .addEventListener("input", function () {
            const query = this.value.toLowerCase();
            filteredData = ncrData.filter(
              (item) =>
                item.ncrNumber.toLowerCase().includes(query) ||
                item.currentStage.toLowerCase().includes(query) ||
                item.supplierName.toLowerCase().includes(query) ||
                new Date(item.dateCreated)
                  .toLocaleDateString("en-US")
                  .toLowerCase()
                  .includes(query)
            );
            currentPage = 1;
            renderTable();
          });

        // Filter buttons
        document.querySelectorAll(".filter-btn").forEach((btn) =>
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            const status = btn.dataset.status;
            filteredData =
              status === "all"
                ? [...ncrData]
                : ncrData.filter((item) => item.status === status);
            currentPage = 1;
            renderTable();
          })
        );

        // Sorting
        function sortTable(colIndex) {
          const keys = [
            "ncrNumber",
            "currentStage",
            "dateCreated",
            "supplierName",
          ];
          if (sortColumn === colIndex) sortAsc = !sortAsc;
          else sortAsc = true;
          sortColumn = colIndex;

          filteredData.sort((a, b) => {
            const valA = a[keys[colIndex]].toLowerCase();
            const valB = b[keys[colIndex]].toLowerCase();
            return (
              (valA > valB ? 1 : valA < valB ? -1 : 0) * (sortAsc ? 1 : -1)
            );
          });
          renderTable();
        }
      </script>
    </main>

    <footer>&copy;Tech Thunders 2025</footer>
    <script src="scripts/script.js"></script>
  </body>
</html>
